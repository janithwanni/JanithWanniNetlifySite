{
  "hash": "cf1545b19b2f31b322748410d5de16d0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'TidyTueday lessons : Volleyball Matches'\nauthor: Janith Wanniarachchi\ndate: '2020-05-19'\ndescription: Learnt lessons from TidyTuesday on Volleyball matches\nexecute:\n  freeze: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(warning = FALSE)\n```\n:::\n\n\n# Beach Volleyball Pairs\nFor this weeks TidyTuesday dataset, the R4DS community has given a dataset on Volleyball Match statistics. This contained data in a wide format and the matches were mostly from the international FIVB tournaments but about 1/3 is from the US-centric AVP. I had only a vague idea about Beach Volleyball as I personally have played only regular volleyball(is there a term for that?) during PE period in school. So to get an idea I opened up youtube and searched beach volleyball and looked at the first match, which turned out to be a women's beach volleyball match. And so I watched and I had a small question as to what pairs of players normally go well together as I heard the commentators explaining how these players played well with these partners and so on. \n\n\n## Load Data\n\n\n::: {.cell}\n\n:::\n\n\n## Filtering \n\nSince it was far less biased to look at the International Matches I had filtered it below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select only international matches\nint_df <- vb_matches %>% \n  filter(circuit == \"FIVB\")\n```\n:::\n\n\nHere I found a fun little use for functional programming as I wanted to get only the columns that had a complete rate of over 95%. I refrained from trying to handle the serves and attack columns due to this reason as their complete rate was quite low and to impute them would have caused even more of an hassle. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#select only the columns that have a complete rate of over 95%\n\nsum_na <- compose(sum,is.na)\nis_not_na <- negate(is.na)\ncomplete_rate_mapper <- as_mapper(~ 100 - (sum_na(.x)/length(.x) * 100 ))\n\nint_df <- int_df[,names(keep(map(int_df,complete_rate_mapper),\n                             ~ .x > 95))]\n# skimr::skim(int_df)\n```\n:::\n\n\n\n# Data Cleaning\n\nInitially I found having two countries of the players seperate odd and therefore thought of merging them only to realize that there were instances where the countries didn't match. (which was quite odd to me). Regardless I decided to name those mixed and let it be. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#merge player countries\nint_df <- int_df %>%\n  mutate(w_country = if_else(\n    w_p1_country == w_p2_country,w_p1_country,\"Mixed\"),\n    l_country = if_else(\n      l_p1_country == l_p2_country,l_p1_country,\"Mixed\")\n    ) %>%\n  select(-l_p1_country,-l_p2_country,-w_p1_country,-w_p2_country)\n```\n:::\n\n\nThere were so many tournaments played in this dataset and to look at them all together made all the graphs really cluttered and therefore I thought to use only the top 10 tournaments with highest number of records. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# recode gender variables\nint_df <- int_df %>% \n  mutate(gender = fct_recode(gender,\"Men\" = \"M\",\"Women\" = \"W\"))\n\n# limiting the problem to the top 10 tournaments\ntop_ten_tournaments <- int_df %>% select(tournament) %>% count(tournament) %>% arrange(desc(n)) %>% top_n(1) %>% .$tournament\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nSelecting by n\n```\n\n\n:::\n\n```{.r .cell-code}\nint_df <- int_df %>% filter(tournament %in% top_ten_tournaments)\n```\n:::\n\n\n## Finding the best player performances\n\nEven then there were too many, hence I decided to limit my scope to only the Mens team in USA. \nSo to start finding the best player pair combinations the first thing I did was to count the Wins and Losses for the player combinations seperately. and then I combined them together and then got the percentages of wins and losses from total matches per player combination. And then I plotted a pair plot to see it. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#for one country and one gender and for one tournament\nm_country <- \"United States\"\nm_gender <- \"Men\"\nm_w_df <- int_df %>% \n  filter(gender == m_gender & w_country == m_country) %>% \n  count(w_player1,w_player2) %>% \n  mutate(win_loss = \"Win\")\n\nm_l_df <- int_df %>% \n  filter(gender == m_gender & l_country == m_country ) %>% \n  count(l_player1,l_player2) %>% \n  mutate(win_loss = \"Loss\")\n\nm_df <- bind_rows(m_w_df %>% \n                    rename(player_1 = w_player1) %>%\n                    rename(player_2 = w_player2)\n                  ,m_l_df %>% \n                    rename(player_1 = l_player1) %>%\n                    rename(player_2 = l_player2))\nm_df <- m_df %>% \n  mutate(player_1 = gsub(\"([A-Z][a-z])*\\\\s([A-Z])[a-z]*\",\"\\\\1 \\\\2.\",m_df$player_1),\n         player_2 = gsub(\"([A-Z][a-z])*\\\\s([A-Z])[a-z]*\",\"\\\\1 \\\\2.\",m_df$player_2)) %>% \n  group_by(player_1,player_2) %>% \n  mutate(perc = n / sum(n)) %>% \n  ungroup()\n\nggplot(m_df %>% \n         mutate(pairs = row.names(m_df),\n                win_loss = factor(win_loss,levels=c(\"Win\",\"Loss\"))) %>% \n         gather(player,name,player_1,player_2),\n       aes(x=player,y=name,group=pairs)) +\n  geom_point(aes(color=win_loss,alpha=perc)) +\n  geom_line(aes(color=win_loss,alpha=perc)) + \n  labs(x = \"Player\",y=\"Name\",alpha=\"Ratio of Win/Loss\",color=\"Win/Loss\",title=\"Player Combinations in United States Men's Team in Gstaad Tournament for all years\") +\n  scale_color_brewer(palette=\"Set1\")\n```\n\n::: {.cell-output-display}\n![](2020-06-13-tidy-tueday-lessons-volleyball-matches_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## An approach with a different statistic\n\nNow there were several problems with the above statistics. One was that multiple colors on one another really didn't convey which one was the best. \n\nInstead of using that confusing statistic I decided to use something different. I calculated the ratio of wins and losses as before and this time I calculated the difference between the ratios and then decided to categorize them by postive, negative or zero change. \n\nIn addition I also used some regular expressions to edit the names of the players so that I can put the names on the plot without cluttering the entire axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# different approach\nm_w_df <- int_df %>% \n  filter(gender == m_gender & \n           w_country == m_country \n  ) %>% \n  count(w_player1,w_player2,name=\"n_wins\") %>% \n  rename(player_1 = w_player1) %>%\n  rename(player_2 = w_player2)\n\nm_l_df <- int_df %>% \n  filter(gender == m_gender & \n           l_country == m_country \n  ) %>% \n  count(l_player1,l_player2,name = \"n_loss\") %>% \n  rename(player_1 = l_player1) %>%\n  rename(player_2 = l_player2)\n\nm_df <- m_w_df %>% \n  full_join(m_l_df) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(player_1, player_2)`\n```\n\n\n:::\n\n```{.r .cell-code}\nm_df[is.na(m_df$n_wins),\"n_wins\"] <- 0\nm_df[is.na(m_df$n_loss),\"n_loss\"] <- 0\nm_df <- m_df %>% \n  mutate(total = n_wins + n_loss,\n         ratio_wins = n_wins / total,\n         ratio_loss = n_loss / total,\n         ratio_diff = ratio_wins - ratio_loss) %>% \n  mutate(good_bad = factor(case_when(\n    (ratio_diff > 0) ~ 0.8,\n    (ratio_diff < 0) ~ 0.2,\n    (ratio_diff == 0) ~ 0.5\n  ),levels=c(0.2,0.5,0.8),labels=c(\"Bad\",\"Neutral\",\"Good\"))) %>% \n  select(-ratio_wins,-ratio_loss,-total,-ratio_diff)\n  \nm_df <- m_df %>% \n  mutate(player_1 = gsub(\"([A-Z][a-z])*\\\\s([A-Z])[a-z]*\",\"\\\\1 \\\\2.\",m_df$player_1),\n         player_2 = gsub(\"([A-Z][a-z])*\\\\s([A-Z])[a-z]*\",\"\\\\1 \\\\2.\",m_df$player_2))\n\nm_df %>% \n  mutate(pairs = row.names(m_df)) %>% \n  gather(player,name,player_1,player_2) %>% \nggplot(aes(x=player,y=name,group=pairs)) +\n  geom_point(size=0.9) +\n  geom_line(aes(color=good_bad,alpha=as.numeric(good_bad)),size=1.0) + \n  labs(x = \"Player\",y=\"Name\",\n       color=\"Pair Performance\",\n       title=\"Player Combinations in United States Men's Team in Gstaad Tournament for all years\",\n       alpha = \"Pair Performance\") +\n  scale_color_brewer(palette=\"Set1\") +\n  scale_alpha_continuous(breaks=c(0.2,0.5,0.8))\n```\n\n::: {.cell-output-display}\n![](2020-06-13-tidy-tueday-lessons-volleyball-matches_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n## Ending notes\n\nAlthough the plot looked beautiful, it's still not helpful at all. Maybe adding a plotly widget with tooltip text or annotating the best combinations might be helpful but I dont see any way to annotate without cluttering the plot. ",
    "supporting": [
      "2020-06-13-tidy-tueday-lessons-volleyball-matches_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}